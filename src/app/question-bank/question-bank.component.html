<div class="question-bank-container">
    <nav class="smart-navbar" [class.scrolled]="isScrolled">
        <div class="nav-container">
            <a routerLink="/dashboard" class="brand-logo">
                <span class="brand-text">OACA Hub</span>
            </a>

            <div class="nav-links" [class.active]="isMobileMenuOpen">
                <div class="nav-link-wrapper">
                    <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
                        class="nav-link">
                        <i class="fas fa-home link-icon"></i>
                        <span>Dashboard</span>
                        <div class="link-underline"></div>
                    </a>

                    <a routerLink="/exam" routerLinkActive="active" class="nav-link">
                        <i class="fas fa-puzzle-piece link-icon"></i>
                        <span>Exam Simulator</span>
                        <div class="link-underline"></div>
                    </a>

                    <a routerLink="/question-bank" routerLinkActive="active" class="nav-link">
                        <i class="fas fa-database link-icon"></i>
                        <span>Question Bank</span>
                        <div class="link-underline"></div>
                    </a>
                </div>

                <div class="nav-actions">
                    <button class="user-menu">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>

            <button class="hamburger" (click)="toggleMobileMenu()" aria-label="Toggle navigation">
                <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                </span>
            </button>
        </div>
    </nav>

    <div class="question-bank-wrapper">
        <br><br><br><br>
        <div class="bank-header">
            <div class="header-content">
                <h2 class="bank-title">
                    <i class="fas fa-database pulse"></i>
                    <span class="gradient-text">Knowledge Vault</span>
                </h2>
                <div class="stats-grid">
                    <div class="stat-card neon">
                        <i class="fas fa-box-open"></i>
                        <div>
                            <h3>Total Questions</h3>
                            <p>{{questions.length}}</p>
                        </div>
                    </div>
                    <div class="stat-card neon">
                        <i class="fas fa-brain"></i>
                        <div>
                            <h3>AI Generated</h3>
                            <p>+{{aiGeneratedCount}}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="search-box glow-on-hover">
                    <input type="text" placeholder="Search aviation knowledge..." [(ngModel)]="searchQuery"
                        (input)="filterQuestions()">
                    <i class="fas fa-search"></i>
                </div>
                <button class="ai-generator-btn" (click)="showAIGenerator = true">
                    <i class="fas fa-robot"></i>
                    <span>Generate</span>
                    <div class="hover-effect"></div>
                </button>
            </div>
        </div>

        <div class="content-grid">
            <div class="filter-panel">
                <app-question-category [categories]="categories"
                    (categoryChange)="selectedCategory = $event; filterQuestions()">
                </app-question-category>

                <div class="difficulty-filter">
                    <h4>Difficulty Spectrum</h4>
                    <div class="difficulty-levels">
                        <button *ngFor="let diff of difficulties" [class.active]="selectedDifficulty === diff"
                            (click)="toggleDifficulty(diff)">
                            <span class="difficulty-dot {{diff}}"></span>
                            {{diff | titlecase}}
                        </button>
                    </div>
                </div>
            </div>

            <div class="question-panel">
                <app-question-list [questions]="filteredQuestions" (questionSelected)="showQuestionDetail($event)">
                </app-question-list>
            </div>

            <div class="detail-panel" [class.active]="selectedQuestion">
                <div class="detail-content" *ngIf="selectedQuestion">
                    <button class="close-detail" (click)="selectedQuestion = null">
                        <i class="fas fa-times"></i>
                    </button>
                    <h3 class="question-title">{{selectedQuestion.text}}</h3>
                    <div class="question-meta">
                        <span class="category-tag {{selectedQuestion.category.toLowerCase()}}">
                            {{selectedQuestion.category}}
                        </span>
                        <span class="difficulty-badge {{selectedQuestion.difficulty}}">
                            {{selectedQuestion.difficulty}}
                        </span>
                    </div>
                    <div class="question-options">
                        <div *ngFor="let opt of selectedQuestion.options; let i = index" class="option-card"
                            [class.correct]="opt.correct">
                            <div class="option-index">{{i + 1}}</div>
                            <div class="option-text">{{opt.text}}</div>
                            <div class="correct-indicator">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ai-generator-modal" [class.active]="showAIGenerator">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-magic"></i> AI Question Forge</h3>
                    <button class="close-modal" (click)="showAIGenerator = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="ai-configurator">
                    <div class="input-group">
                        <label>Topic</label>&nbsp;
                        <input type="text" [(ngModel)]="aiTopic"
                            placeholder="Enter aviation topic (e.g. 'RVSM procedures')">
                    </div>

                    <div class="input-group">
                        <label>Difficulty : </label>
                        <div class="difficulty-selector">
                            <button *ngFor="let diff of difficulties" [class.active]="aiDifficulty === diff"
                                (click)="aiDifficulty = diff">
                                <span class="difficulty-glow {{diff}}"> |</span>
                                {{diff | titlecase}}
                            </button>
                        </div>
                    </div>

                    <button class="generate-btn" (click)="generateAIQuestion()" [disabled]="aiLoading || !aiTopic">
                        <div class="btn-content">
                            <i class="fas fa-robot" [class.spin]="aiLoading"></i>
                            {{aiLoading ? 'Crafting Question...' : 'Forge Question'}}
                        </div>
                        <div class="btn-glow"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>